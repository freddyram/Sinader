/*!
 * v-file-input v0.1.1
 * (c) 2019 shrpne
 * Released under the MIT License.
 */

!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports):"function"==typeof define&&define.amd?define(["exports"],t):t(e.VFileInput=e.VFileInput||{})}(this,function(e){"use strict";function b(e){var t=typeof e;return null!=e&&("object"==t||"function"==t)}HTMLCanvasElement.prototype.toBlob||Object.defineProperty(HTMLCanvasElement.prototype,"toBlob",{value:function(r,o,a){var s=this;setTimeout(function(){for(var e=atob(s.toDataURL(o,a).split(",")[1]),t=e.length,n=new Uint8Array(t),i=0;i<t;i++)n[i]=e.charCodeAt(i);r(new Blob([n],{type:o||"image/png"}))})}});var t="object"==typeof global&&global&&global.Object===Object&&global,n="object"==typeof self&&self&&self.Object===Object&&self,i=t||n||Function("return this")(),w=function(){return i.Date.now()},r=i.Symbol,o=Object.prototype,a=o.hasOwnProperty,s=o.toString,f=r?r.toStringTag:void 0;var c=Object.prototype.toString;var u="[object Null]",l="[object Undefined]",d=r?r.toStringTag:void 0;function p(e){return null==e?void 0===e?l:u:d&&d in Object(e)?function(e){var t=a.call(e,f),n=e[f];try{var i=!(e[f]=void 0)}catch(e){}var r=s.call(e);return i&&(t?e[f]=n:delete e[f]),r}(e):(t=e,c.call(t));var t}var v="[object Symbol]";var g=NaN,h=/^\s+|\s+$/g,m=/^[-+]0x[0-9a-f]+$/i,y=/^0b[01]+$/i,E=/^0o[0-7]+$/i,D=parseInt;function U(e){if("number"==typeof e)return e;if("symbol"==typeof(t=e)||null!=(n=t)&&"object"==typeof n&&p(t)==v)return g;var t,n;if(b(e)){var i="function"==typeof e.valueOf?e.valueOf():e;e=b(i)?i+"":i}if("string"!=typeof e)return 0===e?e:+e;e=e.replace(h,"");var r=y.test(e);return r||E.test(e)?D(e.slice(2),r?2:8):m.test(e)?g:+e}var j="Expected a function",F=Math.max,L=Math.min;function x(i,r,e){var o,a,s,f,c,u,l=0,d=!1,p=!1,t=!0;if("function"!=typeof i)throw new TypeError(j);function v(e){var t=o,n=a;return o=a=void 0,l=e,f=i.apply(n,t)}function g(e){var t=e-u;return void 0===u||r<=t||t<0||p&&s<=e-l}function h(){var e,t,n=w();if(g(n))return m(n);c=setTimeout(h,(t=r-((e=n)-u),p?L(t,s-(e-l)):t))}function m(e){return c=void 0,t&&o?v(e):(o=a=void 0,f)}function n(){var e,t=w(),n=g(t);if(o=arguments,a=this,u=t,n){if(void 0===c)return l=e=u,c=setTimeout(h,r),d?v(e):f;if(p)return c=setTimeout(h,r),v(u)}return void 0===c&&(c=setTimeout(h,r)),f}return r=U(r)||0,b(e)&&(d=!!e.leading,s=(p="maxWait"in e)?F(U(e.maxWait)||0,r):s,t="trailing"in e?!!e.trailing:t),n.cancel=function(){void 0!==c&&clearTimeout(c),o=u=a=c=void(l=0)},n.flush=function(){return void 0===c?f:m(w())},n}var T=0,O=!1,P=!1,A={render:function(){var e=this,t=e.$createElement;return(e._self._c||t)("input",{staticClass:"file-input",attrs:{type:"file",multiple:e.multiple,disabled:e.disabled,accept:e.accept},on:{change:e.onChange}})},staticRenderFns:[],props:{multiple:{type:Boolean,default:!1},disabled:{type:Boolean,default:!1},accept:{type:String},maxWidth:{type:Number},maxHeight:{type:Number}},data:function(){return{fileApiError:!1}},computed:{acceptedTypes:function(){return"string"!=typeof this.accept?[]:this.accept.split(",").map(function(e){return e.replace("/*","").trim()}).filter(function(e){return!!e.length})},emitDragState:function(){var e=this;return function(e,t,n){var i=!0,r=!0;if("function"!=typeof e)throw new TypeError("Expected a function");return b(n)&&(i="leading"in n?!!n.leading:i,r="trailing"in n?!!n.trailing:r),x(e,t,{leading:i,maxWait:t,trailing:r})}(function(){!O||P||e.disabled?!O&&P&&(e.$emit("on-drag-end"),P=!1):(e.$emit("on-drag-start"),P=!0)},50)}},beforeMount:function(){window.File&&window.FileReader&&window.FileList&&window.Blob||(this.$emit("on-error"),this.fileApiError=!0)},mounted:function(){function e(e,t){e.forEach(function(e){window.addEventListener(e,t)})}this.fileApiError||(e(["dragover","drop"],this.preventPageReload),window.addEventListener("drop",this.onDrop),window.addEventListener("paste",this.onPaste),e(["dragenter","dragover"],this.onDragEnter),e(["dragleave","dragend","drop"],this.onDragLeave))},destroyed:function(){function e(e,t){e.forEach(function(e){window.removeEventListener(e,t)})}this.fileApiError||(e(["dragover","drop"],this.preventPageReload),window.removeEventListener("drop",this.onDrop),window.removeEventListener("paste",this.onPaste),e(["dragenter","dragover"],this.onDragEnter),e(["dragleave","dragend","drop"],this.onDragLeave))},methods:{onChange:function(e){this.fileApiError||this.disabled||(e.preventDefault(),this.processFiles(e.target.files))},onDrop:function(e){this.disabled||e.dataTransfer.files.length&&this.processFiles(e.dataTransfer.files)},onPaste:function(e){if(!this.disabled){var t=[];for(var n in e.clipboardData.items){var i=e.clipboardData.items[n];"file"===i.kind&&t.push(i.getAsFile())}t.length&&this.processFiles(t)}},onDragEnter:function(){O=!0,this.emitDragState()},onDragLeave:function(){O=!1,this.emitDragState()},preventPageReload:function(e){e.preventDefault()},processFiles:function(n){for(var r=this,e=this.multiple?n.length:1,o=[],a=[],t=function(i){var t=n[i];if(r.isAcceptedFile(t)){var e=new Promise(function(n){new Promise(function(e){var u,l,d;t.type.match("image.*")&&(r.maxWidth||r.maxHeight)?(u=t,l=r.maxWidth,d=r.maxHeight,new Promise(function(a){var s=new Image,c=URL.createObjectURL(u);s.onload=function(){URL.revokeObjectURL(c);var t=s.width,n=s.height;n<t?l<t&&(n*=l/t,t=l):d<n&&(t*=d/n,n=d);var i=document.createElement("canvas");i.width=t,i.height=n;var e,f,r,o=i.getContext("2d");e=u,f=function(e){!function(e,t,n,i,r,o){switch(e.height=4<o&&o<9?(e.width=r,i):(e.width=i,r),o){case 2:t.transform(-1,0,0,1,i,0);break;case 3:t.transform(-1,0,0,-1,i,r);break;case 4:t.transform(1,0,0,-1,0,r);break;case 5:t.transform(0,1,1,0,0,0);break;case 6:t.transform(0,1,-1,0,r,0);break;case 7:t.transform(0,-1,-1,0,r,i);break;case 8:t.transform(0,-1,1,0,0,i)}t.drawImage(n,0,0,e.width,e.height)}(i,o,s,t,n,e),i.toBlob(a,u.type)},(r=new FileReader).onload=function(e){var t=new DataView(e.target.result);if(65496!==t.getUint16(0,!1))return f(-2);for(var n=t.byteLength,i=2;i<n;){if(t.getUint16(i+2,!1)<=8)return f(-1);var r=t.getUint16(i,!1);if(i+=2,65505===r){if(1165519206!==t.getUint32(i+=2,!1))return f(-1);var o=18761===t.getUint16(i+=6,!1);i+=t.getUint32(i+4,o);var a=t.getUint16(i,o);i+=2;for(var s=0;s<a;s++)if(274===t.getUint16(i+12*s,o))return f(t.getUint16(i+12*s+8,o))}else{if(65280!=(65280&r))break;i+=t.getUint16(i,!1)}}return f(-1)},r.readAsArrayBuffer(e)},s.src=c})).then(e):e(t)}).then(function(t){r.getDataUrlFromBlob(t).then(function(e){a[i]={id:T,dataUrl:e,name:t.name,size:t.size,type:t.type,blob:t},T++,n()})})});o.push(e)}},i=0;i<e;i++)t(i);o.length&&Promise.all(o).then(function(){r.$emit("on-add",a)})},getDataUrlFromBlob:function(n){return new Promise(function(t){var e=new FileReader;e.onload=function(e){t(e.target.result)},e.readAsDataURL(n)})},isAcceptedFile:function(t){return!this.acceptedTypes.length||this.acceptedTypes.some(function(e){return 0===t.type.indexOf(e)})}}};function R(e){e.component("file-input",A)}"undefined"!=typeof window&&window.Vue&&window.Vue.use(R);e.default=R,e.FileInput=A,e.version="0.1.1",Object.defineProperty(e,"__esModule",{value:!0})});